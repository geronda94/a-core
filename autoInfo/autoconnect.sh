#!/bin/bash

echo "Ищу активный порт ADB..."

# Сканируем localhost в диапазоне портов беспроводной отладки
# Ищем только открытые порты и забираем номер порта
PORT=$(nmap 127.0.0.1 -p 30000-49999 | grep "open" | awk -F'/' '{print $1}')

if [ -z "$PORT" ]; then
    echo "Ошибка: Порт не найден. Проверь, включена ли 'Беспроводная отладка' в настройках!"
else
    echo "Найден порт: $PORT"
    echo "Подключаюсь к 127.0.0.1:$PORT..."
    adb connect 127.0.0.1:$PORT
    
    # Проверка статуса
    sleep 1
    adb devices
fi